/ = render "shared/errors", object: @purchase

= simple_nested_form_for @purchase, html: { id: "purchase-form" } do |f|
  = f.error_notification

  .form-inputs
    .row
      .col-xs-6
        .form-group
          = f.input :purchase_date, as: :string, input_html: {class: "form-control datepicker", data: { "date-format" => "DD/MM/YYYY" }, value: l(@purchase.purchase_date || Date.today, format: :formal)}
          = f.input :vendor, input_html: {class: "form-control"}
          = f.input :remarks, input_html: {class: "form-control"}
          = f.input :person_id, input_html: {class: "form-control", style: "width: 100%;", data: {"init-text" => (@purchase.creator_email rescue current_person.email)}, value: current_person.id, id: "volunteer_select2"}

      .col-xs-6
        .form-group
          .panel.panel-default#items
            .panel-body
              .row
                .col-md-5
                  %p Item
                .col-md-3
                  %p Quantity
                .col-md-3
                  %p Rate
                .col-md-1

              = f.fields_for :transaction_items do |builder|
                .row
                  .col-md-5
                    = builder.association :item, label: false do
                      = builder.select :item_id, Item.all.map{|item| [item.name, item.id, {data: {current_rate: item.current_rate}} ] }, {prompt: "Select an item"}, class: "form-control transaction_item_select"
                  .col-md-3
                    = builder.input :quantity, label: false
                  .col-md-3
                    %p.item-rate
                  .col-md-1
                    = builder.link_to_remove "Remove"

              = f.link_to_add "Add an item", :transaction_items

  .form-actions
    = f.button :submit, "#{@purchase.new_record? ? 'Add purchase' : 'Update purchase'}", class: "btn btn-primary"

